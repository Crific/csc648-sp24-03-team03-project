<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSC648/848</title>
    <link rel="stylesheet" href="../../public/css/index.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Function to load data initially
            load_initial_data();

            // Function to load data on search
            function load_data(query, category) {
                $.ajax({
                    method: "GET",
                    url: "/searchingPost",
                    data: { query: query, category: category },
                    success: function (data) {
                        $('#result').html(data.htmlresponse);
                    }
                });
            }

            $('#searchButton').click(function (event) {
                event.preventDefault();
                var search = $('#searchText').val();
                var category = $('#category').val();
                load_data(search, category);
            });

            $('#price-r').change(function () {
                var sortBy = $(this).val();
                console.log("Sorting by:", sortBy); // Debugging
                sortItems(sortBy, 'Price');
            });

            $('#rentalprice-r').change(function () {
                var sortBy = $(this).val();
                console.log("Sorting by:", sortBy); // Debugging
                sortItems(sortBy, 'RentalPrice');
            });

            function sortItems(sortOrder, sortType) {
                var items = $('.item-container').get();
                items.sort(function (a, b) {
                    var aText = $(a).find('.' + sortType).text().split(': ')[1].trim(); // Ensure we trim any extra whitespace
                    var bText = $(b).find('.' + sortType).text().split(': ')[1].trim();

                    // Check if text says "Not Available" and assign -Infinity or Infinity based on sort order
                    var valA = aText === "Not Available" ? (sortOrder === 'LowHigh' ? Infinity : -Infinity) : parseFloat(aText);
                    var valB = bText === "Not Available" ? (sortOrder === 'LowHigh' ? Infinity : -Infinity) : parseFloat(bText);

                    if (sortOrder === 'LowHigh') {
                        return valA - valB;
                    } else {
                        return valB - valA;
                    }
                });
                $('.custab tbody').empty().append(items);
            }



            function load_initial_data() {
                $.ajax({
                    method: "GET",
                    url: "/searchingPost",
                    success: function (data) {
                        $('#result').html(data.htmlresponse);
                        $('#numResultsFound').hide();
                    }
                });
            }
        });
    </script>


</head>

<body>
    <div class="demo-notice">
        SFSU Software Engineering Project CSC 648-848, Spring 2024. For Demonstration Only
    </div>
    <div class="header">
        <a href="../index.html">
            <img src="../../public/images/From Here to There logo.jpg" alt="Logo" href="../index.html" id="logo">
        </a>
        <form id="searchForm">
            <select id="category">
                <option value="default">Select Category</option>
                <option value="electronics">Electronics</option>
                <option value="books">Books</option>
                <option value="furniture">Furniture</option>
            </select>
            <input type="text" id="searchText" name="searchText" placeholder="i.e. search items">
            <input type="submit" id="searchButton" value="Search">
        </form>
    </div>

    <div class="navbar">
        <ul id="navblock">
            <li><a href="../index.html">Home</a></li>
            <li class="dropdown">
                <a href="#" class="dropbtn">About</a>
                <div class="dropdown-content">
                    <a href="../about/Omar.html">Omar Dajani</a>
                    <a href="../about/GioJung.html">Gio Jung</a>
                    <a href="../about/Justin.html">Justin Isidro</a>
                    <a href="../about/Douglas.html">Douglas Cheung</a>
                    <a href="../about/Gurpreet.html">Gurpreet Natt</a>
                    <a href="../about/Gursimran.html">Gursimran Singh</a>
                </div>
            </li>
            <li><a href="Search.html">Go To Search</a></li>
        </ul>
        <div id="loginButton">
            <a href="login.html">Login</a>
        </div>
    </div>

    <div class="main-content">
        <div class="filters">
            <p>Price Range:</p>
            <select id="price-r">
                <option value="None">None</option>
                <option value="LowHigh">Low to High</option>
                <option value="HighLow">High to Low</option>
            </select>
            <p>Rental Price Range:</p>
            <select id="rentalprice-r">
                <option value="None">None</option>
                <option value="LowHigh">Low to High</option>
                <option value="HighLow">High to Low</option>
            </select>
        </div>
        <div id="result"></div>
    </div>
</body>

</html>
